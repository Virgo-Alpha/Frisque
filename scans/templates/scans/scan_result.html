{# This is a standalone template, it does NOT extend base.html #}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan Result for {{ job.company_name }} - Frisque</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        // Tailwind CSS configuration to match your form page
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-blue-dark': '#2B3C52',
                        'brand-blue-light': '#4A698F',
                        'gray-custom-100': '#F9FAFB',
                        'gray-custom-800': '#2D3748',
                        'red-alert': '#D32F2F',
                        'orange-warn': '#F59E0B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        poppins: ['Poppins', 'sans-serif'],
                    },
                },
            },
        }
    </script>

    {# This will automatically refresh the page every 30 seconds IF the job is still in progress #}
    {% if job.status == 'IN_PROGRESS' or job.status == 'PENDING' %}
        <meta http-equiv="refresh" content="30">
    {% endif %}

    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Poppins', sans-serif; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-custom-100 text-gray-custom-800 flex justify-center py-12 px-4">

    <div class="max-w-4xl w-full p-8 md:p-10 bg-white rounded-lg shadow-2xl border border-gray-200">
        <div class="flex justify-between items-start mb-6">
            <h2 class="text-3xl font-poppins font-bold text-gray-dark-text">Scan Report: {{ job.company_name }}</h2>
            
            {# --- Status Badge --- #}
            {% if job.status == 'COMPLETED' %}
                <span class="text-sm font-semibold text-green-800 bg-green-100 px-3 py-1 rounded-full">Completed</span>
            {% elif job.status == 'IN_PROGRESS' or job.status == 'PENDING' %}
                <span class="text-sm font-semibold text-orange-800 bg-orange-100 px-3 py-1 rounded-full">In Progress...</span>
            {% elif job.status == 'FAILED' %}
                <span class="text-sm font-semibold text-red-800 bg-red-100 px-3 py-1 rounded-full">Failed</span>
            {% endif %}
        </div>

        <hr class="mb-8">

        {# --- Conditional Content Based on Job Status --- #}

        {% if job.status == 'COMPLETED' and job.final_report %}
            {# --- Renders the full report if the job is complete --- #}
            <div class="space-y-6">
                {% for key, value in job.final_report.items %}
                    <div>
                        <h3 class="text-lg font-poppins font-semibold text-brand-blue-dark border-b pb-1 mb-2">{{ key|title }}</h3>
                        
                        {# Check if the value is a list to render it properly #}
                        {% if key in "founders,products,alternatives,pricing_plans" and value %}
                            <ul class="list-disc list-inside space-y-1 pl-2 text-gray-700">
                                {% for item in value %}
                                    <li>{{ item }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-gray-700">{{ value|linebreaksbr }}</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        
        {% elif job.status == 'IN_PROGRESS' or job.status == 'PENDING' %}
            {# --- Shows a waiting message --- #}
            <div class="text-center py-10">
                <p class="text-lg text-gray-600">Your report is being generated by our AI agents.</p>
                <p class="text-sm text-gray-500 mt-2">This page will automatically refresh every 30 seconds. Please wait...</p>
            </div>

        {% else %}
            {# --- Shows an error message if the job failed or has no report --- #}
            <div class="text-center py-10 bg-red-50 rounded-lg">
                <p class="text-lg font-semibold text-red-alert">The scan could not be completed.</p>
                {% if job.results.last.error_message %}
                    <p class="text-sm text-gray-600 mt-2">Reason: {{ job.results.last.error_message }}</p>
                {% endif %}
            </div>
        {% endif %}

        <div class="mt-10 text-center">
            <a href="#" class="text-brand-blue-dark hover:underline font-semibold">‚Üê Back to Dashboard</a>
        </div>
    </div>

</body>
</html>